<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body style="background:#000; color:#fff; padding:20px;">
    <h2>داواکارییەکان</h2>
    <div id="list"></div>
    <script src="script.js"></script>
    <script>
        db.collection("deposits").where("status","==","pending").onSnapshot(snap => {
            const list = document.getElementById('list');
            list.innerHTML = "";
            snap.forEach(doc => {
                const d = doc.data();
                list.innerHTML += `<div style="border:1px solid gold; padding:10px; margin:5px;">
                    <p>یوزەر: ${d.uid} | بڕ: ${d.amount}</p>
                    <button onclick="approve('${doc.id}', '${d.uid}', ${d.amount})">قبوڵکردن</button>
                </div>`;
            });
        });

        async function approve(id, uid, amt) {
            const ref = db.collection("users").doc(uid);
            const user = await ref.get();
            const newBal = (user.data().balance || 0) + amt;
            await ref.update({ balance: newBal });
            await db.collection("deposits").doc(id).update({ status: "approved" });
            alert("پارە زیادکرا!");
        }
    </script>
</body>
</html>
